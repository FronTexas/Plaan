package com.example.plaan;

import java.util.Calendar;

import android.annotation.SuppressLint;
import android.content.Context;
import android.graphics.Color;
import android.support.v4.app.FragmentManager;
import android.text.Editable;
import android.text.TextWatcher;
import android.util.TypedValue;
import android.view.KeyEvent;
import android.view.LayoutInflater;
import android.view.View;
import android.view.View.OnClickListener;
import android.view.inputmethod.EditorInfo;
import android.widget.EditText;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.RelativeLayout;
import android.widget.TextView;
import android.widget.TextView.OnEditorActionListener;

import com.zenkun.datetimepicker.time.RadialPickerLayout;
import com.zenkun.datetimepicker.time.TimePickerDialog;
import com.zenkun.datetimepicker.time.TimePickerDialog.OnTimeSetListener;

@SuppressLint("ViewConstructor")
public class ActivityCard extends RelativeLayout implements OnClickListener,
		OnTimeSetListener, TextWatcher, OnEditorActionListener {

	// timeLeftClcok
	// CountDownTimer timeleftCD;
	// long timeLeft;
	// RelativeLayout rlTimeLeftClock;
	// TextView tvTimeLeft;
	// long millisLeft;

	// the ActivitiesPlaan properties
	ActivitiesPlaan theActivity;
	EditText etActivityName;
	RelativeLayout rlOneTimeText, rlLoopingText;
	int activity_type;

	// ActivitiesSetter
	RelativeLayout rlActivitySetter;

	// oneTime
	LinearLayout llOneTime;
	TextView tvOneTime, tvLooping, tvStartOneTime, tvStartHoursOneTime,
			tvEndOneTime, tvEndHoursOneTime, tvTimeTypeOneTime;
	EditText etTimeOneTime;

	// looping
	LinearLayout llLooping;
	LinearLayout llStartEndLooping, rlStartSectionLooping, rlEndSectionLooping;
	LinearLayout llLoopingSettings;
	TextView tvStartLooping, tvStartHoursLooping, tvEndLooping,
			tvEndHoursLooping, tvX, tvLoopingTimeType, tvBreakTimeType;
	EditText etLoopingFreq, etLoopingTime, etBreakTime;

	// setButton
	RelativeLayout rlSET_Button;
	TextView tvSET;
	onSetClickListener osc;

	// ActivityCountDown
	AutoResizeTextView tvActivitiesNameCD;
	RelativeLayout rlActivityCountDown;
	TextView tvCountDown, tvStartEndCD, tvIntervalOTCD, tvLoopingFreqCD, tvXCD,
			tvLoopingTimeCD, tvBreakTimeCD, tvActivityTypeCD, tvBreakText;
	LinearLayout llOneTimePropertiesCD, llLoopingPropertiesCD;
	ImageView ivToDoButton, ivBackToActivitySetter;
	boolean backToActivtySetterClicked;

	// To Do
	RelativeLayout rlToDo;
	LinearLayout llTask;
	TextView tvToDo, tvActivityNameTD;
	EditText etTask;
	ImageView ivArrowBack;

	FragmentManager fragmentManager;
	Context context;

	int lastThingClicked;

	float scaleDP;
	LayoutInflater layoutInflater;

	public ActivityCard(Context context, FragmentManager fragmentManager,
			LayoutInflater layoutInflater) {
		super(context);
		// this.timeLeft = timeLeft;
		this.context = context;
		this.layoutInflater = layoutInflater;
		this.fragmentManager = fragmentManager;
		lastThingClicked = 0;
		scaleDP = getResources().getDisplayMetrics().density;
		activity_type = ActivitiesPlaan.TYPE_ONE_TIME;
		backToActivtySetterClicked = false;

		LayoutInflater inflater = (LayoutInflater) context
				.getSystemService(Context.LAYOUT_INFLATER_SERVICE);
		addView(inflater.inflate(R.layout.activity_card_layout, null));

		initializeViews();
		setTypefaces();

		// timeLeft clock
		// timeleftCD = new CountDownTimer(this.timeLeft, 1000) {
		// @Override
		// public void onTick(long millisUntilFinished) {
		// // format[0] = hours, format[1] = minutes , format[2] = seconds
		// int[] format = new int[3];
		// formatMillis(format, millisUntilFinished);
		//
		// String s = "";
		// if (format[0] != 0)
		// s += addZeros("" + format[0]) + ":";
		// if (format[0] != 0 || format[1] != 0)
		// s += addZeros("" + format[1]) + ":";
		// s += addZeros("" + format[2]);
		//
		// tvTimeLeft.setText(s);
		// millisLeft = millisUntilFinished;
		// }

		// @Override
		// public void onFinish() {
		//
		// }
		// }.start();

		// oneTime
		rlOneTimeText.setOnClickListener(this);
		rlLoopingText.setOnClickListener(this);
		tvStartHoursOneTime.setOnClickListener(this);
		tvEndHoursOneTime.setOnClickListener(this);
		tvTimeTypeOneTime.setOnClickListener(this);
		etTimeOneTime.addTextChangedListener(this);

		// looping
		tvStartHoursLooping.setOnClickListener(this);
		tvLoopingTimeType.setOnClickListener(this);
		tvBreakTimeType.setOnClickListener(this);
		etLoopingFreq.addTextChangedListener(this);
		etLoopingTime.addTextChangedListener(this);
		etBreakTime.addTextChangedListener(this);

		// setbutton
		rlSET_Button.setOnClickListener(this);

		// activity count doiwn
		ivBackToActivitySetter.setOnClickListener(this);

		// To Do
		ivToDoButton.setOnClickListener(this);
		etTask.setOnEditorActionListener(this);
		ivArrowBack.setOnClickListener(this);

	}

	public interface onSetClickListener {
		public void onSetClick(ActivitiesPlaan theActivity,
				boolean firstTimeVisit);
	}

	public void setOnSetClickListener(onSetClickListener listener) {
		osc = listener;
	}

	private void setTypefaces() {
		TypefacePlaan tfp = new TypefacePlaan();
		tfp.setTypeface(etActivityName, TypefacePlaan.LEAGUE_GOTHIC_ITALIC);

		// time left clock
		// tfp.setTypeface(tvTimeLeft, TypefacePlaan.LEAGUE_GOTHIC);

		// one time
		tfp.setTypeface(tvOneTime, TypefacePlaan.LEAGUE_GOTHIC_ITALIC);
		tfp.setTypeface(tvLooping, TypefacePlaan.LEAGUE_GOTHIC_ITALIC);
		tfp.setTypeface(tvStartOneTime, TypefacePlaan.OPEN_SANS_BOLD);
		tfp.setTypeface(tvStartHoursOneTime, TypefacePlaan.LEAGUE_GOTHIC);
		tfp.setTypeface(tvEndOneTime, TypefacePlaan.OPEN_SANS_BOLD);
		tfp.setTypeface(tvEndHoursOneTime, TypefacePlaan.LEAGUE_GOTHIC);
		tfp.setTypeface(etTimeOneTime, TypefacePlaan.LEAGUE_GOTHIC);
		tfp.setTypeface(tvTimeTypeOneTime, TypefacePlaan.LEAGUE_GOTHIC);

		// looping
		tfp.setTypeface(tvStartLooping, TypefacePlaan.OPEN_SANS_BOLD);
		tfp.setTypeface(tvStartHoursLooping, TypefacePlaan.LEAGUE_GOTHIC);
		tfp.setTypeface(tvEndLooping, TypefacePlaan.OPEN_SANS_BOLD);
		tfp.setTypeface(tvEndHoursLooping, TypefacePlaan.LEAGUE_GOTHIC);
		tfp.setTypeface(tvStartHoursOneTime, TypefacePlaan.LEAGUE_GOTHIC);
		tfp.setTypeface(tvX, TypefacePlaan.LEAGUE_GOTHIC);
		tfp.setTypeface(etLoopingFreq, TypefacePlaan.LEAGUE_GOTHIC);
		tfp.setTypeface(etLoopingTime, TypefacePlaan.LEAGUE_GOTHIC);
		tfp.setTypeface(etBreakTime, TypefacePlaan.LEAGUE_GOTHIC);
		tfp.setTypeface(tvLoopingTimeType, TypefacePlaan.LEAGUE_GOTHIC);
		tfp.setTypeface(tvBreakTimeType, TypefacePlaan.LEAGUE_GOTHIC);

		// tvSET
		tfp.setTypeface(tvSET, TypefacePlaan.LEAGUE_GOTHIC);

		// activityCountDown
		tfp.setTypeface(tvCountDown, TypefacePlaan.LEAGUE_GOTHIC);
		tfp.setTypeface(tvActivitiesNameCD, TypefacePlaan.OPEN_SANS_BOLD);
		tfp.setTypeface(tvStartEndCD, TypefacePlaan.OPEN_SANS_BOLD);
		tfp.setTypeface(tvIntervalOTCD, TypefacePlaan.LEAGUE_GOTHIC);
		tfp.setTypeface(tvLoopingFreqCD, TypefacePlaan.LEAGUE_GOTHIC);
		tfp.setTypeface(tvXCD, TypefacePlaan.LEAGUE_GOTHIC);
		tfp.setTypeface(tvLoopingTimeCD, TypefacePlaan.LEAGUE_GOTHIC);
		tfp.setTypeface(tvBreakTimeCD, TypefacePlaan.LEAGUE_GOTHIC);
		tfp.setTypeface(tvActivityTypeCD, TypefacePlaan.OPEN_SANS_BOLD);
		tfp.setTypeface(tvBreakText, TypefacePlaan.OPEN_SANS_BOLD);

		// To do
		tfp.setTypeface(tvToDo, TypefacePlaan.OPEN_SANS_BOLD);
		tfp.setTypeface(tvActivityNameTD, TypefacePlaan.OPEN_SANS_BOLD);
		tfp.setTypeface(etTask, TypefacePlaan.LEAGUE_GOTHIC);

	}

	public void setTvBreakVisibility(int visibility) {
		tvBreakText.setVisibility(visibility);
	}

	public void decreaseLoopLeft() {
		tvLoopingFreqCD.setText(Integer.parseInt(tvLoopingFreqCD.getText()
				.toString()) - 1);
	}

	public void setTvCountDownText(String text) {
		tvCountDown.setText(text);
	}

	private void initializeViews() {
		// rlTimeLeftClock = (RelativeLayout)
		// findViewById(R.id.rlTimeLeftClock);
		// tvTimeLeft = (TextView) findViewById(R.id.tvTimeLeft);
		etActivityName = (EditText) findViewById(R.id.etActivityName);
		rlOneTimeText = (RelativeLayout) findViewById(R.id.rlOneTimeText);
		rlLoopingText = (RelativeLayout) findViewById(R.id.rlLoopingText);
		tvOneTime = (TextView) findViewById(R.id.tvOneTime);
		tvLooping = (TextView) findViewById(R.id.tvLooping);
		tvStartOneTime = (TextView) findViewById(R.id.tvStartOneTime);
		tvStartHoursOneTime = (TextView) findViewById(R.id.tvStartHoursOneTime);
		tvEndOneTime = (TextView) findViewById(R.id.tvEndOneTime);
		tvEndHoursOneTime = (TextView) findViewById(R.id.tvEndHoursOneTime);
		llLooping = (LinearLayout) findViewById(R.id.llLooping);
		llStartEndLooping = (LinearLayout) findViewById(R.id.llStartEndLooping);
		rlStartSectionLooping = (LinearLayout) findViewById(R.id.rlStartSectionLooping);
		rlEndSectionLooping = (LinearLayout) findViewById(R.id.rlEndSectionLooping);
		llLoopingSettings = (LinearLayout) findViewById(R.id.llLoopingSettings);
		tvStartLooping = (TextView) findViewById(R.id.tvStartLooping);
		tvStartHoursLooping = (TextView) findViewById(R.id.tvStartHoursLooping);
		tvEndLooping = (TextView) findViewById(R.id.tvEndLooping);
		tvEndHoursLooping = (TextView) findViewById(R.id.tvEndHoursLooping);
		tvX = (TextView) findViewById(R.id.tvX);
		etLoopingFreq = (EditText) findViewById(R.id.etLoopingFreq);
		etLoopingTime = (EditText) findViewById(R.id.etLoopingTime);
		etBreakTime = (EditText) findViewById(R.id.etBreakTime);
		llOneTime = (LinearLayout) findViewById(R.id.llOneTime);
		rlSET_Button = (RelativeLayout) findViewById(R.id.rlSET_Button);
		tvSET = (TextView) findViewById(R.id.tvSET);
		tvLoopingTimeType = (TextView) findViewById(R.id.tvLoopingTimeType);
		tvBreakTimeType = (TextView) findViewById(R.id.tvBreakTimeType);
		tvTimeTypeOneTime = (TextView) findViewById(R.id.tvTimeTypeOneTime);
		etTimeOneTime = (EditText) findViewById(R.id.etTimeOneTime);
		tvCountDown = (TextView) findViewById(R.id.tvCountDown);
		tvLoopingFreqCD = (TextView) findViewById(R.id.tvLoopingFreqCD);
		tvXCD = (TextView) findViewById(R.id.tvXCD);
		tvLoopingTimeCD = (TextView) findViewById(R.id.tvLoopingTimeCD);
		tvBreakTimeCD = (TextView) findViewById(R.id.tvBreakTimeCD);
		tvActivityTypeCD = (TextView) findViewById(R.id.tvActivityTypeCD);
		tvIntervalOTCD = (TextView) findViewById(R.id.tvIntervalOTCD);
		tvActivitiesNameCD = (AutoResizeTextView) findViewById(R.id.tvActivitiesNameCD);
		tvStartEndCD = (TextView) findViewById(R.id.tvStartEndCD);
		rlActivityCountDown = (RelativeLayout) findViewById(R.id.rlActivityCountDown);
		rlActivitySetter = (RelativeLayout) findViewById(R.id.rlActivitySetter);
		llLoopingPropertiesCD = (LinearLayout) findViewById(R.id.llLoopingPropertiesCD);
		llOneTimePropertiesCD = (LinearLayout) findViewById(R.id.llOneTimePropertiesCD);
		tvToDo = (TextView) findViewById(R.id.tvToDo);
		tvActivityNameTD = (TextView) findViewById(R.id.tvActivityNameTD);
		etTask = (EditText) findViewById(R.id.etTask);
		rlToDo = (RelativeLayout) findViewById(R.id.rlToDo);
		llTask = (LinearLayout) findViewById(R.id.llTask);
		ivArrowBack = (ImageView) findViewById(R.id.ivArrowBack);
		ivToDoButton = (ImageView) findViewById(R.id.ivTodoButton);
		ivBackToActivitySetter = (ImageView) findViewById(R.id.ivBackToActivitySetter);
		tvBreakText = (TextView) findViewById(R.id.tvBreakText);
	}

	@Override
	public void onClick(View v) {
		if (v.getId() == tvStartHoursOneTime.getId()
				|| v.getId() == tvStartHoursLooping.getId()) {
			// oneTime or Looping START HOURS
			Calendar calendar = Calendar.getInstance();
			TimePickerDialog timePickerDialog = TimePickerDialog.newInstance(
					this, calendar.get(Calendar.HOUR_OF_DAY),
					calendar.get(Calendar.MINUTE), false);
			timePickerDialog.show(fragmentManager, "timepicker");

		} else if (v.getId() == tvEndHoursOneTime.getId()
				|| v.getId() == tvEndHoursLooping.getId()) {
			// oneTime or Looping END HOURS
			TimePickerDialog timePickerDialog = null;

			// the preset clock setting will be equal to the its startHours
			if (lastThingClicked == tvStartHoursLooping.getId()) {
				timePickerDialog = TimePickerDialog.newInstance(
						this,
						Integer.parseInt(tvStartHoursLooping.getText()
								.toString().substring(0, 2)),
						Integer.parseInt(tvStartHoursLooping.getText()
								.toString().substring(3)), false);
			} else {
				timePickerDialog = TimePickerDialog.newInstance(
						this,
						Integer.parseInt(tvStartHoursOneTime.getText()
								.toString().substring(0, 2)),
						Integer.parseInt(tvStartHoursOneTime.getText()
								.toString().substring(3)), false);
			}
			timePickerDialog.show(fragmentManager, "timepicker");

		} else if (v.getId() == rlOneTimeText.getId()) {
			// TYPE_ONE_TIME setter
			rlOneTimeText
					.setBackgroundResource(R.drawable.one_time_or_looping_blue_selection_bar);
			tvOneTime
					.setTextColor(getResources().getColor(R.color.lightergrey));
			rlLoopingText.setBackgroundColor(Color.TRANSPARENT);
			llOneTime.setVisibility(View.VISIBLE);

			tvLooping.setTextColor(getResources().getColor(R.color.darkgrey));
			llLooping.setVisibility(View.INVISIBLE);
			activity_type = ActivitiesPlaan.TYPE_ONE_TIME;
		} else if (v.getId() == rlLoopingText.getId()) {
			// TYPE_LOOPING setter
			rlLoopingText
					.setBackgroundResource(R.drawable.one_time_or_looping_blue_selection_bar);
			tvLooping
					.setTextColor(getResources().getColor(R.color.lightergrey));
			rlOneTimeText.setBackgroundColor(Color.TRANSPARENT);
			llLooping.setVisibility(View.VISIBLE);

			tvOneTime.setTextColor(getResources().getColor(R.color.darkgrey));
			llOneTime.setVisibility(View.INVISIBLE);
			activity_type = ActivitiesPlaan.TYPE_LOOPING;
		} else if (v.getId() == rlSET_Button.getId()) {
			// SET_BUTTON : set theActivity properties based on the settings
			// timeleftCD.cancel();
			// rlTimeLeftClock.setVisibility(View.INVISIBLE);
			theActivity = new ActivitiesPlaan(etActivityName.getText()
					.toString(), activity_type);
			if (activity_type == ActivitiesPlaan.TYPE_ONE_TIME) {
				setOneTimeProperties(theActivity);
			} else if (activity_type == ActivitiesPlaan.TYPE_LOOPING) {
				setLoopingProperties(theActivity);
			}
			theActivity.setActivityCard(this);
			// millisLeft -= theActivity.getInterval() * 60000;
			if (!backToActivtySetterClicked)
				osc.onSetClick(theActivity, true);
			else {
				osc.onSetClick(theActivity, false);
			}
			rlActivitySetter.setVisibility(View.INVISIBLE);
			rlActivityCountDown.setVisibility(View.VISIBLE);
			setActivityCountDownProperties();
		} else if (v.getId() == tvLoopingTimeType.getId()
				|| v.getId() == tvBreakTimeType.getId()
				|| v.getId() == tvTimeTypeOneTime.getId()) {
			// MIN or HRS
			TextView tv = (TextView) v;
			if (tv.getText().toString().equals("MIN"))
				tv.setText("HRS");
			else
				tv.setText("MIN");

		} else if (v.getId() == ivToDoButton.getId()) {
			rlActivityCountDown.setVisibility(View.GONE);
			tvActivityNameTD.setText(tvActivitiesNameCD.getText());
			rlToDo.setVisibility(View.VISIBLE);
		} else if (v.getId() == ivArrowBack.getId()) {
			rlToDo.setVisibility(View.GONE);
			rlActivityCountDown.setVisibility(View.VISIBLE);
		} else if (v.getId() == ivBackToActivitySetter.getId()) {
			rlActivityCountDown.setVisibility(View.INVISIBLE);
			rlActivitySetter.setVisibility(View.VISIBLE);
			backToActivtySetterClicked = true;
		}
		lastThingClicked = v.getId();
	}

	private void setActivityCountDownProperties() {

		tvActivitiesNameCD.setText(etActivityName.getText().toString());
		String start = "";
		String end = "";
		int[] format = new int[3];

		String s = "";

		if (activity_type == ActivitiesPlaan.TYPE_ONE_TIME) {
			start = tvStartHoursOneTime.getText().toString();
			end = tvEndHoursOneTime.getText().toString();
			llOneTimePropertiesCD.setVisibility(View.VISIBLE);
			tvIntervalOTCD.setText(etTimeOneTime.getText().toString()
					+ tvTimeTypeOneTime.getText().toString());
			tvActivityTypeCD.setText("One Time");
			llLoopingPropertiesCD.setVisibility(View.INVISIBLE);

			formatMillis(format, theActivity.interval * 60000);
			if (format[0] != 0)
				s += addZeros("" + format[0]) + ":";
			if (format[0] != 0 || format[1] != 0)
				s += addZeros("" + format[1]) + ":";
			s += addZeros("" + format[2]);
			tvCountDown.setText(s);

		} else if (activity_type == ActivitiesPlaan.TYPE_LOOPING) {
			start = tvStartHoursLooping.getText().toString();
			end = tvEndHoursLooping.getText().toString();
			llLoopingPropertiesCD.setVisibility(View.VISIBLE);
			tvLoopingFreqCD.setText(etLoopingFreq.getText().toString());
			tvLoopingTimeCD.setText(etLoopingTime.getText().toString()
					+ tvLoopingTimeType.getText().toString());
			tvBreakTimeCD.setText(etBreakTime.getText().toString()
					+ tvBreakTimeType.getText().toString());
			tvActivityTypeCD.setText("Looping");
			llOneTimePropertiesCD.setVisibility(View.INVISIBLE);

			formatMillis(format, theActivity.loopTime * 60000);
			if (format[0] != 0)
				s += addZeros("" + format[0]) + ":";
			if (format[0] != 0 || format[1] != 0)
				s += addZeros("" + format[1]) + ":";
			s += addZeros("" + format[2]);
			tvCountDown.setText(s);

		}
		adjustTvCountDown();
		tvStartEndCD.setText(start + " - " + end);
	}

	private void adjustTvCountDown() {
		LayoutParams lp = new LayoutParams(tvCountDown.getMeasuredWidth(),
				tvCountDown.getMeasuredHeight());
		if (tvCountDown.getText().toString().length() == 8) {
			lp.setMargins((int) (45 * scaleDP + 0.5f),
					(int) (90 * scaleDP + 0.5f), 0, 0);
			tvCountDown.setTextSize(TypedValue.COMPLEX_UNIT_SP, 55);
		} else if (tvCountDown.getText().toString().length() == 5) {
			lp.setMargins((int) (50 * scaleDP + 0.5f),
					(int) (80 * scaleDP + 0.5f), 0, 0);
			tvCountDown.setTextSize(TypedValue.COMPLEX_UNIT_SP, 70);
		} else if (tvCountDown.getText().toString().length() == 2) {
			lp.setMargins((int) (65 * scaleDP + 0.5f),
					(int) (60 * scaleDP + 0.5f), 0, 0);
			tvCountDown.setTextSize(TypedValue.COMPLEX_UNIT_SP, 100);
		}
		tvCountDown.setLayoutParams(lp);
	}

	private void setLoopingProperties(ActivitiesPlaan theActivity) {
		int[] startHours = new int[1];
		int[] startMinutes = new int[1];

		int[] loops = new int[1];
		int[] loopTime = new int[1];
		int[] loopType = new int[1];

		int[] breakTime = new int[1];

		int[] breakTimeType = new int[1];
		retreiveLoopingIntervalParameters(startHours, startMinutes, loops,
				loopTime, loopType, breakTime, breakTimeType);

		theActivity.setInterval(startHours[0], startMinutes[0], loops[0],
				loopTime[0], loopType[0], breakTime[0], breakTimeType[0]);
	}

	private void setOneTimeProperties(ActivitiesPlaan theActivity) {
		int startHours = Integer.parseInt(tvStartHoursOneTime.getText()
				.toString().substring(0, 2));
		int startMinutes = Integer.parseInt(tvStartHoursOneTime.getText()
				.toString().substring(3));
		int endHours = Integer.parseInt(tvEndHoursOneTime.getText().toString()
				.substring(0, 2));
		int endMinutes = Integer.parseInt(tvEndHoursOneTime.getText()
				.toString().substring(3));
		theActivity.setInterval(startHours, startMinutes, endHours, endMinutes,
				"", "");
	}

	private int checkForType(String ls) {
		if (ls.equals("MIN")) {
			return ActivitiesPlaan.LOOPTYPE_MINUTE;
		}
		return ActivitiesPlaan.LOOPTYPE_HOUR;
	}

	@Override
	public void onTimeSet(RadialPickerLayout v, int hourOfDay, int minute) {
		if (lastThingClicked == tvStartHoursOneTime.getId()) {
			// set the starHours of OneTime
			tvStartHoursOneTime.setText(addZeros("" + hourOfDay) + ":"
					+ addZeros("" + minute));
			tvStartHoursOneTime.setAlpha((float) 1.0);
			tvStartHoursOneTime.setWidth(tvStartHoursOneTime.getWidth()
					+ ((int) (8 * scaleDP + 0.5f)));
		} else if (lastThingClicked == tvEndHoursOneTime.getId()) {
			// set the endHours of OneTime
			tvEndHoursOneTime.setText(addZeros("" + hourOfDay) + ":"
					+ addZeros("" + minute));
			tvEndHoursOneTime.setAlpha((float) 1.0);
			tvEndHoursOneTime.setWidth(tvEndHoursOneTime.getWidth()
					+ ((int) (8 * scaleDP + 0.5f)));
		} else if (lastThingClicked == tvStartHoursLooping.getId()) {
			// set the startHours of Looping
			tvStartHoursLooping.setText(addZeros("" + hourOfDay) + ":"
					+ addZeros("" + minute));
			tvStartHoursLooping.setAlpha((float) 1.0);
		} else if (lastThingClicked == tvEndHoursLooping.getId()) {
			// set the endHours of Looping
			tvEndHoursLooping.setText(addZeros("" + hourOfDay) + ":"
					+ addZeros("" + minute));
			tvEndHoursLooping.setAlpha((float) 1.0);
		}
	}

	private String addZeros(String s) {
		if (s.length() == 1) {
			s = "0" + s;
		}
		return s;
	}

	@Override
	public void onTextChanged(CharSequence arg0, int arg1, int arg2, int arg3) {

	}

	private void calculateOneTimeInterval() {
		int interval = 0;
		if (etTimeOneTime.getText().toString().length() > 0)
			interval = Integer.parseInt(etTimeOneTime.getText().toString());
		if (tvTimeTypeOneTime.getText().toString().equals("HRS")) {
			interval = interval * 60;
		}
		int startHours = Integer.parseInt(tvStartHoursOneTime.getText()
				.toString().substring(0, 2));
		int startMinutes = Integer.parseInt(tvStartHoursOneTime.getText()
				.toString().substring(3));
		int[] endHours = new int[1];
		int[] endMinutes = new int[1];
		int[] hoursIncreased = new int[1];
		endHours[0] = startHours + interval / 60;
		endMinutes[0] = startMinutes + interval % 60;

		checkForMoreThan(endMinutes, 60, hoursIncreased);
		endHours[0] += hoursIncreased[0];
		checkForMoreThan(endHours, 24, hoursIncreased);

		tvEndHoursOneTime.setAlpha(1);
		tvEndHoursOneTime.setText(addZeros("" + endHours[0]) + ":"
				+ addZeros("" + endMinutes[0]));

	}

	private void calculateLoopingInterval() {

		int interval = 0;
		int[] startHours = new int[1];
		int[] startMinutes = new int[1];

		int[] loops = new int[1];
		int[] loopTime = new int[1];
		int[] loopType = new int[1];

		int[] breakTime = new int[1];

		int[] breakTimeType = new int[1];
		retreiveLoopingIntervalParameters(startHours, startMinutes, loops,
				loopTime, loopType, breakTime, breakTimeType);
		switch (loopType[0]) {
		case ActivitiesPlaan.LOOPTYPE_MINUTE:
			// interval is in minutes
			interval = loops[0] * (loopTime[0] + breakTime[0]);
			break;
		case ActivitiesPlaan.LOOPTYPE_HOUR:
			// interval is in minutes
			interval = loops[0] * (loopTime[0] * 60 + breakTime[0]);
			break;
		}

		int[] endHours = new int[1];
		int[] endMinutes = new int[1];
		int[] hoursIncreased = new int[1];
		endHours[0] = startHours[0] + interval / 60;
		endMinutes[0] = startMinutes[0] + interval % 60;

		checkForMoreThan(endMinutes, 60, hoursIncreased);
		endHours[0] += hoursIncreased[0];
		checkForMoreThan(endHours, 24, hoursIncreased);

		tvEndHoursLooping.setAlpha(1);
		tvEndHoursLooping.setText(addZeros("" + endHours[0]) + ":"
				+ addZeros("" + endMinutes[0]));
	}

	private void checkForMoreThan(int[] time, int usualNumber,
			int[] hoursIncreased) {
		while (time[0] >= usualNumber) {
			time[0] -= usualNumber;
			hoursIncreased[0]++;
		}

	}

	private void retreiveLoopingIntervalParameters(int[] startHours,
			int[] startMinutes, int[] loops, int[] loopTime, int[] loopType,
			int[] breakTime, int[] breakTimeType) {
		startHours[0] = Integer.parseInt(tvStartHoursLooping.getText()
				.toString().substring(0, 2));
		startMinutes[0] = Integer.parseInt(tvStartHoursLooping.getText()
				.toString().substring(3));

		String loopsString = etLoopingFreq.getText().toString();
		String loopTimeString = etLoopingTime.getText().toString();
		String breakTimeString = etBreakTime.getText().toString();

		loops[0] = Integer.parseInt(loopsString);
		loopTime[0] = Integer.parseInt(loopTimeString);
		String loopTypeString = tvLoopingTimeType.getText().toString();
		loopType[0] = checkForType(loopTypeString);

		breakTime[0] = Integer.parseInt(breakTimeString);

		String breakTimeTypeString = tvBreakTimeType.getText().toString();
		breakTimeType[0] = checkForType(breakTimeTypeString);

	}

	private boolean allLoopingPropertiesFilled() {
		return (etLoopingFreq.getText().toString().length() != 0)
				&& (etLoopingTime.getText().toString().length() != 0)
				&& (etBreakTime.getText().toString().length() != 0);
	}

	private void formatMillis(int[] format, long millisUntilFinished) {
		// format[0] = hours, format[1] = minutes , format[2] = seconds
		format[0] = (int) ((millisUntilFinished / (1000 * 60 * 60)) % 24);
		format[1] = (int) ((millisUntilFinished / (1000 * 60)) % 60);
		format[2] = (int) (millisUntilFinished / 1000) % 60;
	}

	@Override
	public void afterTextChanged(Editable arg0) {
		if (activity_type == ActivitiesPlaan.TYPE_LOOPING
				&& allLoopingPropertiesFilled()) {
			calculateLoopingInterval();
		} else if (activity_type == ActivitiesPlaan.TYPE_ONE_TIME) {
			// etTimeOneTime is listened
			if (tvStartHoursOneTime.getText().toString().length() > 0)
				calculateOneTimeInterval();
		}
	}

	@Override
	public void beforeTextChanged(CharSequence arg0, int arg1, int arg2,
			int arg3) {
	}

	@Override
	public boolean onEditorAction(TextView v, int actionId, KeyEvent event) {
		switch (actionId) {
		case EditorInfo.IME_ACTION_NEXT:
			// EditText newEtTask = new EditText(getContext());
			// newEtTask.setBackgroundResource(R.color.transparent);
			// newEtTask.setTextSize(TypedValue.COMPLEX_UNIT_SP, 30);
			// newEtTask.setHint("Add Task");
			// newEtTask.setHintTextColor(Color.rgb(235, 236, 236));
			// newEtTask.setTextColor(Color.rgb(179, 179, 179));
			// newEtTask.setImeOptions(EditorInfo.IME_ACTION_NEXT);
			// newEtTask.setSingleLine();
			// TypefacePlaan tfp = new TypefacePlaan();
			// tfp.setTypeface(newEtTask, TypefacePlaan.LEAGUE_GOTHIC);
			// LayoutParams lpNewEtTask = new LayoutParams(
			// LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT);
			// lpNewEtTask.setMargins(0, (int) (10 * scaleDP + 0.5f), 0, 0);
			// newEtTask.setOnEditorActionListener(this);
			// llTask.addView(newEtTask, lpNewEtTask);
			break;

		default:
			break;
		}
		return false;
	}

}
